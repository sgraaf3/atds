<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATDS Health & Breath Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="container" data-i18n-container>
    <header>
        <div>
            <h1 data-i18n="appTitle">ATDS Health Report</h1>
            <div class="subtitle" data-i18n="subtitle">Bio-Metric Analysis System</div>
        </div>
        <div style="text-align: right;">
            <button id="btnSettings" class="btn-secondary" style="padding: 4px 8px; font-size: 12px; margin-bottom: 5px;" data-i18n="settings">⚙ Settings</button><br>
            <strong data-i18n="status">Status:</strong> <span style="color: green;" data-i18n="statusReady">Ready</span><br>
            <div id="signalContainer" class="hidden" style="margin-top: 4px; font-size: 0.9em;">
                <strong data-i18n="signal">Signal:</strong> <span id="signalDot" class="signal-dot"></span>
                <span id="signalText">--</span>
            </div>
            <small data-i18n="noDeviceConnected">No Device Connected (File Mode)</small>
        </div>
    </header>

    <div class="controls">
        <div class="input-group" data-i18n-group="loadData">
            <label data-i18n="loadData">Load Data <span class="tooltip-icon" data-tooltip-i18n="loadDataTooltip">?</span></label>
            <input type="file" id="fileInput" accept=".txt,.csv,.atds">
        </div>
        <div class="input-group" data-i18n-group="weight">
            <label data-i18n="weight" data-i18n-suffix="(kg)">Weight (kg) <span class="tooltip-icon" data-tooltip-i18n="weightTooltip">?</span></label>
            <input type="number" id="weight" value="75" data-tooltip-i18n="weightTooltip">
        </div>
        <div class="input-group" data-i18n-group="age">
            <label data-i18n="age" data-i18n-suffix="(years)">Age (years) <span class="tooltip-icon" data-tooltip-i18n="ageTooltip">?</span></label>
            <input type="number" id="age" value="30" data-tooltip-i18n="ageTooltip">
        </div>
        <div class="input-group" data-i18n-group="gender">
            <label data-i18n="gender">Gender <span class="tooltip-icon" data-tooltip-i18n="genderTooltip">?</span></label>
            <select id="gender" data-tooltip-i18n="genderTooltip">
                <option value="male" data-i18n="male">Male</option>
                <option value="female" data-i18n="female">Female</option>
            </select>
        </div>
        <div class="input-group" style="grid-column: span 2;" data-i18n-group="deviceConnection">
            <label data-i18n="deviceConnection">Device Connection</label>
            <button id="btnConnectSerial" class="btn-secondary" style="margin-bottom: 5px;" data-i18n="connectUSBDongle" data-tooltip-i18n="connectUSBDongleTooltip">Connect USB Dongle</button>
            <button id="btnConnectBT" class="btn-secondary" data-i18n="connectBluetoothLE" data-tooltip-i18n="connectBluetoothLETooltip">Connect Bluetooth LE</button>
        </div>
    </div>

    <div id="resultsArea" class="hidden">
        <div class="dashboard" id="dashboardMetrics">
            <div class="stat-card">
                <div class="stat-label" data-i18n="avgHeartRate">Avg Heart Rate <span class="tooltip-icon" data-tooltip-i18n="avgHeartRateTooltip">?</span></div>
                <div class="stat-value" id="dispAvgHR">--</div>
                <small data-i18n="bpmShort">BPM</small>
            </div>
            <div class="stat-card">
                <div class="stat-label" data-i18n="tiTeRatio">Ti / Te Ratio <span class="tooltip-icon" data-tooltip-i18n="tiTeRatioTooltip">?</span></div>
                <div class="stat-value" id="dispTiTe">--</div>
                <small data-i18n="tiTeDesc">Inhale/Exhale Efficiency</small>
            </div>
            <div class="stat-card">
                <div class="stat-label" data-i18n="breathRate">Breath Rate <span class="tooltip-icon" data-tooltip-i18n="breathRateTooltip">?</span></div>
                <div class="stat-value" id="dispBreathRate">--</div>
                <small data-i18n="brMin">Breaths/Min</small>
            </div>
            <div class="stat-card">
                <div class="stat-label" data-i18n="hrvAmplitudeShort">HRV Amplitude <span class="tooltip-icon" data-tooltip-i18n="hrvAmplitudeTooltip">?</span></div>
                <div class="stat-value" id="dispHrvAmp">--</div>
                <small data-i18n="msRSA">ms (RSA)</small>
            </div>
            <!-- VO2 Max card is injected by UIManager.js -->
            <!-- SDNN/RMSSD card is injected by UIManager.js -->
        </div>

        <div class="chart-row">
            <div class="chart-wrapper" id="mainChartWrapper">
                <canvas id="mainChart"></canvas>
            </div>
            <div class="chart-wrapper hidden" id="secondaryChartWrapper">
                <canvas id="secondaryChart"></canvas>
            </div>
        </div>

        <div class="report-text">
            <h3 data-i18n="analysisSummary">Analysis Summary</h3>
            <p id="reportContent" data-i18n="uploadDataToSeeAnalysis">Upload data to see analysis.</p>
            
            <h4 data-i18n="trainingZones">Training Zones (Estimated)</h4>
            <table class="zone-table" id="zoneTable">
                <!-- Populated by JS -->
            </table>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal hidden">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 data-i18n="preferences">Preferences</h2>
        <div class="input-group" data-i18n-group="weightUnit">
            <label data-i18n="weightUnit">Weight Unit <span class="tooltip-icon" data-tooltip-i18n="weightUnitTooltip">?</span></label>
            <select id="settingWeightUnit" data-tooltip-i18n="weightUnitTooltip">
                <option value="kg" data-i18n="kilograms">Kilograms (kg)</option>
                <option value="lbs" data-i18n="pounds">Pounds (lbs)</option>
            </select>
        </div>
        <div class="input-group" data-i18n-group="deviceProtocol">
            <label data-i18n="deviceProtocol">Device Protocol <span class="tooltip-icon" data-tooltip-i18n="deviceProtocolTooltip">?</span></label>
            <select id="settingProtocol" data-tooltip-i18n="deviceProtocolTooltip">
                <option value="serial" data-i18n="usbSerial">USB Serial (BM-USBCDC)</option>
                <option value="ble" data-i18n="bluetoothLE">Bluetooth LE (BlueRobin)</option>
            </select>
        </div>
        <div class="input-group" data-i18n-group="language">
            <label data-i18n="language">Language <span class="tooltip-icon" data-tooltip-i18n="languageTooltip">?</span></label>
            <select id="settingLanguage" data-tooltip-i18n="languageTooltip">
                <option value="en" data-i18n="english">English</option>
                <option value="nl" data-i18n="dutch">Dutch (Nederlands)</option>
                <option value="de" data-i18n="german">German (Deutsch)</option>
                <option value="fr" data-i18n="french">French (Français)</option>
            </select>
        </div>
        <div class="input-group" data-i18n-group="darkMode">
            <label data-i18n="darkMode">Dark Mode <span class="tooltip-icon" data-tooltip-i18n="darkModeTooltip">?</span></label>
            <input type="checkbox" id="settingDarkMode" style="width: auto; margin-top: 5px;" data-tooltip-i18n="darkModeTooltip">
        </div>
        <div class="input-group" data-i18n-group="connectedDeviceFW">
            <label data-i18n="connectedDeviceFW">Connected Device FW <span class="tooltip-icon" data-tooltip-i18n="connectedDeviceFWTooltip">?</span></label>
            <div id="settingFirmware" style="padding: 10px; background: #eee; border-radius: 4px; font-size: 0.9em;" data-i18n-default="--" data-tooltip-i18n="connectedDeviceFWTooltip">--</div>
        </div>
        <button id="btnSaveSettings" class="btn-secondary" style="margin-top: 15px; width: 100%;" data-i18n="savePreferences" data-tooltip-i18n="savePreferencesTooltip">Save Preferences</button>
    </div>
</div>

<script type="module" src="app.js"></script>
</body>
</html>